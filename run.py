import geoVeRoPy
import json
import sys

C1 = {
    1: {'loc': (45, 68)},
    2: {'loc': (45, 70)},
    3: {'loc': (42, 66)},
    4: {'loc': (42, 68)},
    5: {'loc': (42, 65)},
    6: {'loc': (40, 69)},
    7: {'loc': (40, 66)},
    8: {'loc': (38, 68)},
    9: {'loc': (38, 70)},
    10: {'loc': (35, 66)},
    11: {'loc': (35, 69)},
    12: {'loc': (25, 85)},
    13: {'loc': (22, 75)},
    14: {'loc': (22, 85)},
    15: {'loc': (20, 80)},
    16: {'loc': (20, 85)},
    17: {'loc': (18, 75)},
    18: {'loc': (15, 75)},
    19: {'loc': (15, 80)},
    20: {'loc': (30, 50)},
    21: {'loc': (30, 52)},
    22: {'loc': (28, 52)},
    23: {'loc': (28, 55)},
    24: {'loc': (25, 50)},
    25: {'loc': (25, 52)},
    26: {'loc': (25, 55)},
    27: {'loc': (23, 52)},
    28: {'loc': (23, 55)},
    29: {'loc': (20, 50)},
    30: {'loc': (20, 55)},
    31: {'loc': (10, 35)},
    32: {'loc': (10, 40)},
    33: {'loc': ( 8, 40)},
    34: {'loc': ( 8, 45)},
    35: {'loc': ( 5, 35)},
    36: {'loc': ( 5, 45)},
    37: {'loc': ( 2, 40)},
    38: {'loc': ( 0, 40)},
    39: {'loc': ( 0, 45)},
    40: {'loc': (35, 30)},
    41: {'loc': (35, 32)},
    42: {'loc': (33, 32)},
    43: {'loc': (33, 35)},
    44: {'loc': (32, 30)},
    45: {'loc': (30, 30)},
    46: {'loc': (30, 32)},
    47: {'loc': (30, 35)},
    48: {'loc': (28, 30)},
    49: {'loc': (28, 35)},
    50: {'loc': (26, 32)},
    51: {'loc': (25, 30)},
    52: {'loc': (25, 35)},
    53: {'loc': (44,  5)},
    54: {'loc': (42, 10)},
    55: {'loc': (42, 15)},
    56: {'loc': (40,  5)},
    57: {'loc': (40, 15)},
    58: {'loc': (38,  5)},
    59: {'loc': (38, 15)},
    60: {'loc': (35,  5)},
    61: {'loc': (50, 30)},
    62: {'loc': (50, 35)},
    63: {'loc': (50, 40)},
    64: {'loc': (48, 30)},
    65: {'loc': (48, 40)},
    66: {'loc': (47, 35)},
    67: {'loc': (47, 40)},
    68: {'loc': (45, 30)},
    69: {'loc': (45, 35)},
    70: {'loc': (95, 30)},
    71: {'loc': (95, 35)},
    72: {'loc': (53, 30)},
    73: {'loc': (92, 30)},
    74: {'loc': (53, 35)},
    75: {'loc': (45, 65)},
    76: {'loc': (90, 35)},
    77: {'loc': (88, 30)},
    78: {'loc': (88, 35)},
    79: {'loc': (87, 30)},
    80: {'loc': (85, 25)},
    81: {'loc': (85, 35)},
    82: {'loc': (75, 55)},
    83: {'loc': (72, 55)},
    84: {'loc': (70, 58)},
    85: {'loc': (68, 60)},
    86: {'loc': (66, 55)},
    87: {'loc': (65, 55)},
    88: {'loc': (65, 60)},
    89: {'loc': (63, 58)},
    90: {'loc': (60, 55)},
    91: {'loc': (60, 60)},
    92: {'loc': (67, 85)},
    93: {'loc': (65, 85)},
    94: {'loc': (65, 82)},
    95: {'loc': (62, 80)},
    96: {'loc': (60, 80)},
    97: {'loc': (60, 85)},
    98: {'loc': (58, 75)},
    99: {'loc': (55, 80)},
    100: {'loc':  (55,85)},
}
depotC1 = (40, 50)

C2 = {
    1: {'loc': (52, 75)},
    2: {'loc': (45, 70)},
    3: {'loc': (62, 69)},
    4: {'loc': (60, 66)},
    5: {'loc': (42, 65)},
    6: {'loc': (16, 42)},
    7: {'loc': (58, 70)},
    8: {'loc': (34, 60)},
    9: {'loc': (28, 70)},
    10: {'loc': (35, 66)},
    11: {'loc': (35, 69)},
    12: {'loc': (25, 85)},
    13: {'loc': (22, 75)},
    14: {'loc': (22, 85)},
    15: {'loc': (20, 80)},
    16: {'loc': (20, 85)},
    17: {'loc': (18, 75)},
    18: {'loc': (15, 75)},
    19: {'loc': (15, 80)},
    20: {'loc': (30, 50)},
    21: {'loc': (30, 56)},
    22: {'loc': (28, 52)},
    23: {'loc': (14, 66)},
    24: {'loc': (25, 50)},
    25: {'loc': (22, 66)},
    26: {'loc': ( 8, 62)},
    27: {'loc': (23, 52)},
    28: {'loc': ( 4, 55)},
    29: {'loc': (20, 50)},
    30: {'loc': (20, 55)},
    31: {'loc': (10, 35)},
    32: {'loc': (10, 40)},
    33: {'loc': ( 8, 40)},
    34: {'loc': ( 8, 45)},
    35: {'loc': ( 5, 35)},
    36: {'loc': ( 5, 45)},
    37: {'loc': ( 2, 40)},
    38: {'loc': ( 0, 40)},
    39: {'loc': ( 0, 45)},
    40: {'loc': (36, 18)},
    41: {'loc': (35, 32)},
    42: {'loc': (33, 32)},
    43: {'loc': (33, 35)},
    44: {'loc': (32, 20)},
    45: {'loc': (30, 30)},
    46: {'loc': (34, 25)},
    47: {'loc': (30, 35)},
    48: {'loc': (36, 40)},
    49: {'loc': (48, 20)},
    50: {'loc': (26, 32)},
    51: {'loc': (25, 30)},
    52: {'loc': (25, 35)},
    53: {'loc': (44,  5)},
    54: {'loc': (42, 10)},
    55: {'loc': (42, 15)},
    56: {'loc': (40,  5)},
    57: {'loc': (38, 15)},
    58: {'loc': (38,  5)},
    59: {'loc': (38, 10)},
    60: {'loc': (35,  5)},
    61: {'loc': (50, 30)},
    62: {'loc': (50, 35)},
    63: {'loc': (50, 40)},
    64: {'loc': (48, 30)},
    65: {'loc': (44, 25)},
    66: {'loc': (47, 35)},
    67: {'loc': (47, 40)},
    68: {'loc': (42, 30)},
    69: {'loc': (45, 35)},
    70: {'loc': (95, 30)},
    71: {'loc': (95, 35)},
    72: {'loc': (53, 30)},
    73: {'loc': (92, 30)},
    74: {'loc': (53, 35)},
    75: {'loc': (45, 65)},
    76: {'loc': (90, 35)},
    77: {'loc': (72, 45)},
    78: {'loc': (78, 40)},
    79: {'loc': (87, 30)},
    80: {'loc': (85, 25)},
    81: {'loc': (85, 35)},
    82: {'loc': (75, 55)},
    83: {'loc': (72, 55)},
    84: {'loc': (70, 58)},
    85: {'loc': (86, 46)},
    86: {'loc': (66, 55)},
    87: {'loc': (64, 46)},
    88: {'loc': (65, 60)},
    89: {'loc': (56, 64)},
    90: {'loc': (60, 55)},
    91: {'loc': (60, 60)},
    92: {'loc': (67, 85)},
    93: {'loc': (42, 58)},
    94: {'loc': (65, 82)},
    95: {'loc': (62, 80)},
    96: {'loc': (62, 40)},
    97: {'loc': (60, 85)},
    98: {'loc': (58, 75)},
    99: {'loc': (55, 80)},
    100: {'loc': (55, 85)},
}
depotC2 = (40, 50)

R = {
    1: {'loc': (41, 49)},
    2: {'loc': (35, 17)},
    3: {'loc': (55, 45)},
    4: {'loc': (55, 20)},
    5: {'loc': (15, 30)},
    6: {'loc': (25, 30)},
    7: {'loc': (20, 50)},
    8: {'loc': (10, 43)},
    9: {'loc': (55, 60)},
    10: {'loc': (30, 60)},
    11: {'loc': (20, 65)},
    12: {'loc': (50, 35)},
    13: {'loc': (30, 25)},
    14: {'loc': (15, 10)},
    15: {'loc': (30,  5)},
    16: {'loc': (10, 20)},
    17: {'loc': ( 5, 30)},
    18: {'loc': (20, 40)},
    19: {'loc': (15, 60)},
    20: {'loc': (45, 65)},
    21: {'loc': (45, 20)},
    22: {'loc': (45, 10)},
    23: {'loc': (55,  5)},
    24: {'loc': (65, 35)},
    25: {'loc': (65, 20)},
    26: {'loc': (45, 30)},
    27: {'loc': (35, 40)},
    28: {'loc': (41, 37)},
    29: {'loc': (64, 42)},
    30: {'loc': (40, 60)},
    31: {'loc': (31, 52)},
    32: {'loc': (35, 69)},
    33: {'loc': (53, 52)},
    34: {'loc': (65, 55)},
    35: {'loc': (63, 65)},
    36: {'loc': ( 2, 60)},
    37: {'loc': (20, 20)},
    38: {'loc': ( 5,  5)},
    39: {'loc': (60, 12)},
    40: {'loc': (40, 25)},
    41: {'loc': (42,  7)},
    42: {'loc': (24, 12)},
    43: {'loc': (23,  3)},
    44: {'loc': (11, 14)},
    45: {'loc': ( 6, 38)},
    46: {'loc': ( 2, 48)},
    47: {'loc': ( 8, 56)},
    48: {'loc': (13, 52)},
    49: {'loc': ( 6, 68)},
    50: {'loc': (47, 47)},
    51: {'loc': (49, 58)},
    52: {'loc': (27, 43)},
    53: {'loc': (37, 31)},
    54: {'loc': (57, 29)},
    55: {'loc': (63, 23)},
    56: {'loc': (53, 12)},
    57: {'loc': (32, 12)},
    58: {'loc': (36, 26)},
    59: {'loc': (21, 24)},
    60: {'loc': (17, 34)},
    61: {'loc': (12, 24)},
    62: {'loc': (24, 58)},
    63: {'loc': (27, 69)},
    64: {'loc': (15, 77)},
    65: {'loc': (62, 77)},
    66: {'loc': (49, 73)},
    67: {'loc': (67,  5)},
    68: {'loc': (56, 39)},
    69: {'loc': (37, 47)},
    70: {'loc': (37, 56)},
    71: {'loc': (57, 68)},
    72: {'loc': (47, 16)},
    73: {'loc': (44, 17)},
    74: {'loc': (46, 13)},
    75: {'loc': (49, 11)},
    76: {'loc': (49, 42)},
    77: {'loc': (53, 43)},
    78: {'loc': (61, 52)},
    79: {'loc': (57, 48)},
    80: {'loc': (56, 37)},
    81: {'loc': (55, 54)},
    82: {'loc': (15, 47)},
    83: {'loc': (14, 37)},
    84: {'loc': (11, 31)},
    85: {'loc': (16, 22)},
    86: {'loc': ( 4, 18)},
    87: {'loc': (28, 18)},
    88: {'loc': (26, 52)},
    89: {'loc': (26, 35)},
    90: {'loc': (31, 67)},
    91: {'loc': (15, 19)},
    92: {'loc': (22, 22)},
    93: {'loc': (18, 24)},
    94: {'loc': (26, 27)},
    95: {'loc': (25, 24)},
    96: {'loc': (22, 27)},
    97: {'loc': (25, 21)},
    98: {'loc': (19, 21)},
    99: {'loc': (20, 26)},
    100: {'loc': (18, 18)},
}
depotR = (35, 35)

RC = {
    1: {'loc': (25, 85)}, 
    2: {'loc': (22, 75)}, 
    3: {'loc': (22, 85)}, 
    4: {'loc': (20, 80)}, 
    5: {'loc': (20, 85)}, 
    6: {'loc': (18, 75)}, 
    7: {'loc': (15, 75)}, 
    8: {'loc': (15, 80)}, 
    9: {'loc': (10, 35)}, 
    10: {'loc': (10, 40)}, 
    11: {'loc': ( 8, 40)}, 
    12: {'loc': ( 8, 45)}, 
    13: {'loc': ( 5, 35)}, 
    14: {'loc': ( 5, 45)}, 
    15: {'loc': ( 2, 40)}, 
    16: {'loc': ( 0, 40)}, 
    17: {'loc': ( 0, 45)}, 
    18: {'loc': (44,  5)}, 
    19: {'loc': (42, 10)}, 
    20: {'loc': (42, 15)}, 
    21: {'loc': (40,  5)}, 
    22: {'loc': (40, 15)}, 
    23: {'loc': (38,  5)}, 
    24: {'loc': (38, 15)}, 
    25: {'loc': (35,  5)}, 
    26: {'loc': (95, 30)}, 
    27: {'loc': (95, 35)}, 
    28: {'loc': (92, 30)}, 
    29: {'loc': (90, 35)}, 
    30: {'loc': (88, 30)}, 
    31: {'loc': (88, 35)}, 
    32: {'loc': (87, 30)}, 
    33: {'loc': (85, 25)}, 
    34: {'loc': (85, 35)}, 
    35: {'loc': (67, 85)}, 
    36: {'loc': (65, 85)}, 
    37: {'loc': (65, 82)}, 
    38: {'loc': (62, 80)}, 
    39: {'loc': (60, 80)}, 
    40: {'loc': (60, 85)}, 
    41: {'loc': (58, 75)}, 
    42: {'loc': (55, 80)}, 
    43: {'loc': (55, 85)}, 
    44: {'loc': (55, 82)}, 
    45: {'loc': (20, 82)}, 
    46: {'loc': (18, 80)}, 
    47: {'loc': ( 2, 45)}, 
    48: {'loc': (42,  5)}, 
    49: {'loc': (42, 12)}, 
    50: {'loc': (72, 35)}, 
    51: {'loc': (55, 20)}, 
    52: {'loc': (25, 30)}, 
    53: {'loc': (20, 50)}, 
    54: {'loc': (55, 60)}, 
    55: {'loc': (30, 60)}, 
    56: {'loc': (50, 35)}, 
    57: {'loc': (30, 25)}, 
    58: {'loc': (15, 10)}, 
    59: {'loc': (10, 20)}, 
    60: {'loc': (15, 60)}, 
    61: {'loc': (45, 65)}, 
    62: {'loc': (65, 35)}, 
    63: {'loc': (65, 20)}, 
    64: {'loc': (45, 30)}, 
    65: {'loc': (35, 40)}, 
    66: {'loc': (41, 37)}, 
    67: {'loc': (64, 42)}, 
    68: {'loc': (40, 60)}, 
    69: {'loc': (31, 52)}, 
    70: {'loc': (35, 69)}, 
    71: {'loc': (65, 55)}, 
    72: {'loc': (63, 65)}, 
    73: {'loc': ( 2, 60)}, 
    74: {'loc': (20, 20)}, 
    75: {'loc': ( 5,  5)}, 
    76: {'loc': (60, 12)}, 
    77: {'loc': (23,  3)}, 
    78: {'loc': ( 8, 56)}, 
    79: {'loc': ( 6, 68)}, 
    80: {'loc': (47, 47)}, 
    81: {'loc': (49, 58)}, 
    82: {'loc': (27, 43)}, 
    83: {'loc': (37, 31)}, 
    84: {'loc': (57, 29)}, 
    85: {'loc': (63, 23)}, 
    86: {'loc': (21, 24)}, 
    87: {'loc': (12, 24)}, 
    88: {'loc': (24, 58)}, 
    89: {'loc': (67,  5)}, 
    90: {'loc': (37, 47)}, 
    91: {'loc': (49, 42)}, 
    92: {'loc': (53, 43)}, 
    93: {'loc': (61, 52)}, 
    94: {'loc': (57, 48)}, 
    95: {'loc': (56, 37)}, 
    96: {'loc': (55, 54)}, 
    97: {'loc': ( 4, 18)}, 
    98: {'loc': (26, 52)}, 
    99: {'loc': (26, 35)}, 
    100: {'loc': (31, 67)}, 
}
depotRC = (40, 50)

if __name__ == '__main__':
    nodeDistr = sys.argv[1]
    configPath = sys.argv[2]
    pklPath = sys.argv[3]

    nodes = None
    depotLoc = None
    if (nodeDistr == 'C1'):
        nodes = C1
        depotLoc = depotC1
    elif (nodeDistr == 'C2'):
        nodes = C2
        depotLoc = depotC2
    elif (nodeDistr == 'RC'):
        nodes = RC
        depotLoc = depotRC
    elif (nodeDistr == 'R'):
        nodes = R
        depotLoc = depotR

    config = None
    with open(configPath) as json_file:
        config = json.load(json_file)

    for n in nodes:
        nodes[n]['scoreList'] = config['scoreList']

    stop = {}
    if (config['numIter'] != None):
        stop['numIter'] = config['numIter']
    if (config['runtime'] != None):
        stop['runtime'] = config['runtime']
    if (config['numNoImproveIter'] != None):
        stop['numNoImproveIter'] = config['numNoImproveIter']

    cetsp = geoVeRoPy.solveGCEOP(
        startLoc = depotLoc,
        endLoc = depotLoc,
        nodes = nodes,
        popSize = config['popSize'],
        neighRatio = {
            'crossover': config['crossover'],
            'intraSwap': config['intraSwap'],
            'interSwap': config['interSwap'],
            'exchange': config['exchange'],
            'rotate': config['rotate'],
            'rndDestroy': config['rndDestroy']
        },
        radiusList = config['radiusList'],
        maxLength = config['maxLength'],
        stop = stop)
    geoVeRoPy.saveDictionary(cetsp, pklPath)
    print("OFV: ", cetsp['ofv'])
