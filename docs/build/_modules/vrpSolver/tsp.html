<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vrpSolver.tsp &#8212; vrpSolver 0.0.56 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b849a4e9" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxdoc.css?v=87629129" />
    <script src="../../_static/documentation_options.js?v=8f83b1af"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">vrpSolver 0.0.56 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">vrpSolver.tsp</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vrpSolver.tsp</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">heapq</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.geometry</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.msg</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="solveTSP">
<a class="viewcode-back" href="../../vrpSolver.tsp.html#vrpSolver.tsp.solveTSP">[docs]</a>
<span class="k">def</span> <span class="nf">solveTSP</span><span class="p">(</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> 
    <span class="n">locFieldName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;loc&#39;</span><span class="p">,</span>
    <span class="n">depotID</span><span class="p">:</span> <span class="nb">int</span><span class="o">|</span><span class="nb">str</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">nodeIDs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="o">|</span><span class="nb">str</span><span class="p">]</span><span class="o">|</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    <span class="n">vehicleID</span><span class="p">:</span> <span class="nb">int</span><span class="o">|</span><span class="nb">str</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">serviceTime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">predefinedArcs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="o">|</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">edges</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Euclidean&#39;</span><span class="p">,</span>
    <span class="n">algo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;IP&#39;</span><span class="p">,</span>
    <span class="n">detailsFlag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">metaFlag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use MIP/Heuristic to find optimal/sub-optimal TSP solution</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    nodes: dict, required</span>
<span class="sd">        The `nodes` dictionary, with coordinates of given nodes. See :ref:`nodes`</span>
<span class="sd">    locFieldName: str, optional, default as &#39;loc&#39;</span>
<span class="sd">        The key value in `nodes` indicating the location of each node.</span>
<span class="sd">    depotID: int|string, optional, default as 0</span>
<span class="sd">        The node ID of the depot.</span>
<span class="sd">    nodeIDs: string &#39;All&#39; or a list of node IDs, optional, default as &#39;All&#39;</span>
<span class="sd">        The following are two options: 1) &#39;All&#39;, all nodes will be visited, 2) A list of node IDs to be visited.</span>
<span class="sd">    vehicles: dict, optional, default as {0: {&#39;speed&#39;: 1}}</span>
<span class="sd">        The vehicle information, since the TSP optimizes route for one vehicle, only the first vehicle with `vehicleID` will be considered. The speed of vehicle needs to be specified.</span>
<span class="sd">    vehicleID: int|str, optional, default as 0</span>
<span class="sd">        The vehicle that takes the TSP route in `vehicles`.</span>
<span class="sd">    serviceTime: float, optional, default as 0</span>
<span class="sd">        The service time needed at each location. If `serviceTime` is provided in `nodes`, it will be ignored.</span>
<span class="sd">    predefinedArcs: list of nodeID pairs, optional, default as []</span>
<span class="sd">        In some cases, some of the arcs are predefined, they will be modeled as additional constraints.</span>
<span class="sd">    edges: string, optional, default as &#39;Euclidean&#39;</span>
<span class="sd">        The methods for the calculation of distances between nodes. Options and required additional information are referred to :func:`~vrpSolver.geometry.matrixDist()`.</span>
<span class="sd">    algo: string, optional, default as &#39;IP&#39;</span>
<span class="sd">        Select the algorithm for calculating TSP. Options and required additional inputs are as follows:</span>
<span class="sd">        </span>
<span class="sd">        1) (default) &#39;IP&#39;, use (Mixed) Integer Programming to solve TSP. Needs commercial solver such as Gurobi and COPT.</span>
<span class="sd">            - solver: str, supports &#39;Gurobi&#39; and &#39;COPT&#39;.</span>
<span class="sd">            - fml: str, choose formulation of TSP:</span>
<span class="sd">                - if use &#39;Gurobi&#39; as solver, fml supports the following options: [&#39;DFJ_Lazy&#39;, &#39;DFJ_Plainloop&#39;, &#39;MTZ&#39;, &#39;ShortestPath&#39;, &#39;MultiCommodityFlow&#39;, &#39;QAP&#39;]. In fact, &#39;DFJ_Lazy&#39; will be faster than all other formulations, implementation of different formulation is for education purpose.</span>
<span class="sd">                - if use &#39;COPT&#39; as solver, fml supports &#39;DFJ_Lazy&#39;.</span>
<span class="sd">            - timeLimit: int|float, additional stopping criteria</span>
<span class="sd">            - gapTolerance: int|float, additional stopping criteria</span>
<span class="sd">            - outputFlag: bool, True if turn on the log output from solver. Default to be False</span>
<span class="sd">        2) &#39;Heuristic&#39;, use different 2-phase heuristic methods to solve TSP to sub-optimal. </span>
<span class="sd">            - cons: str, choose a construction heuristic to find a feasible TSP solution, options and addition inputs needed are as follows:</span>
<span class="sd">                - cons = &#39;Initial&#39;, use a given initial solution, requires the following information:</span>
<span class="sd">                    - initSeq: a list of node IDs</span>
<span class="sd">                - cons = &#39;Insertion&#39;, in each iteration, insert a node into the existing route, which has the minimal cost.</span>
<span class="sd">                - cons = &#39;RandomInsertion&#39;, in each iteration, randomly insert a not that has not yet been inserted to the route.</span>
<span class="sd">                - cons = &#39;NearestNeighbor&#39;, in each iteration, find the (k-)nearest node to the end of existing route and add it to the route.</span>
<span class="sd">                    - k: the k-th nearest neighbor, default to be 1</span>
<span class="sd">                - cons = &#39;Sweep&#39;, sweep all nodes clock-wise (or counter-clock-wise) and add the node to the route one by one.</span>
<span class="sd">                - cons = &#39;Christofides&#39;, use Christofides algorithm</span>
<span class="sd">                - cons = &#39;CycleCover&#39;, use CycleCover algorithm, particularly design for Asymmetric TSP</span>
<span class="sd">                - cons = &#39;Random&#39;, randomly create a feasible route</span>
<span class="sd">            - impv: str, choose the local improvement heuristic to improve the existing feasible route</span>
<span class="sd">                - impv = &#39;2Opt&#39;, use the 2-opt algorithm</span>
<span class="sd">    detailsFlag: bool, optional, default as False</span>
<span class="sd">        If True, an additional field `vehicle` will be added into the solution, which can be used for animation. See :func:`~vrpSolver.plot.aniRouting()`.</span>
<span class="sd">    **kwargs: optional</span>
<span class="sd">        Provide additional inputs for different `edges` options and `algo` options</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    dict</span>
<span class="sd">        A TSP solution in the following format::</span>
<span class="sd">            &gt;&gt;&gt; solution = {</span>
<span class="sd">            ...     &#39;ofv&#39;: ofv,</span>
<span class="sd">            ...     &#39;seq&#39;: seq,</span>
<span class="sd">            ...     &#39;gap&#39;: gap,</span>
<span class="sd">            ...     &#39;solType&#39;: solType,</span>
<span class="sd">            ...     &#39;lowerBound&#39;: lb,</span>
<span class="sd">            ...     &#39;upperBound&#39;: ub,</span>
<span class="sd">            ...     &#39;runtime&#39;: runtime</span>
<span class="sd">            ... }</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Sanity check ============================================================</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="n">ERROR_MISSING_NODES</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">locFieldName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="s2">&quot;ERROR: missing location information in `nodes`.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nodeIDs</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
            <span class="n">nodeIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: Node </span><span class="si">%s</span><span class="s2"> is not in `nodes`.&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">depotID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">nodeIDs</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span> <span class="ow">and</span> <span class="n">depotID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find `depotID` in given `nodes`/`nodeIDs`&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">detailsFlag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="c1"># For animation propose</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vehicles</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="s2">&quot;ERROR: Missing required field `vehicles`.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vehicleID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vehicles</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find `vehicleID` in `vehicles`.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;IP&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;solver&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="s2">&quot;ERROR: Missing required field `solver`.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gurobi&#39;</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DFJ_Lazy&#39;</span><span class="p">,</span> <span class="s1">&#39;DFJ_Plainloop&#39;</span><span class="p">,</span> <span class="s1">&#39;MTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;ShortestPath&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiCommodityFlow&#39;</span><span class="p">,</span> <span class="s1">&#39;QAP&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: Gurobi option s upports &#39;DFJ_Lazy&#39;, &#39;DFJ_Plainloop&#39;, &#39;MTZ&#39;, &#39;ShortestPath&#39;, &#39;MultiCommodityFlow&#39;, and &#39;QAP&#39; formulations&quot;</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COPT&#39;</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DFJ_Lazy&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: COPT option supports &#39;DFJ_Lazy&#39; formulations&quot;</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;Heuristic&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;cons&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;impv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="n">ERROR_MISSING_TSP_ALGO</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">predefinedArcs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">predefinedArcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;IP&#39;</span> <span class="ow">and</span> <span class="s1">&#39;fml&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DFJ_Lazy&#39;</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: TSP with pre-defined arcs is supported by DFJ_Lazy only, for now.&quot;</span><span class="p">)</span>

    <span class="c1"># Define tau ==============================================================</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">detailsFlag</span><span class="p">):</span>
        <span class="n">tau</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">matrixDist</span><span class="p">(</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">,</span> 
            <span class="n">nodeIDs</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">,</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">,</span> 
            <span class="n">locFieldName</span> <span class="o">=</span> <span class="n">locFieldName</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tau</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">matrixDist</span><span class="p">(</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">,</span> 
            <span class="n">nodeIDs</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">,</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">,</span> 
            <span class="n">locFieldName</span> <span class="o">=</span> <span class="n">locFieldName</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Check symmetric =========================================================</span>
    <span class="n">asymFlag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]):</span>
            <span class="n">asymFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="c1"># TSP =====================================================================</span>
    <span class="n">tsp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;IP&#39;</span><span class="p">):</span>
        <span class="n">outputFlag</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="s1">&#39;outputFlag&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;outputFlag&#39;</span><span class="p">]</span>
        <span class="n">timeLimit</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="s1">&#39;timeLimit&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timeLimit&#39;</span><span class="p">]</span>
        <span class="n">gapTolerance</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="s1">&#39;gapTolerance&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gapTolerance&#39;</span><span class="p">]</span>
        <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSP</span><span class="p">(</span>
            <span class="n">nodeIDs</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">,</span> 
            <span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span><span class="p">,</span> 
            <span class="n">solver</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
            <span class="n">fml</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">],</span> 
            <span class="n">predefinedArcs</span> <span class="o">=</span> <span class="n">predefinedArcs</span><span class="p">,</span> 
            <span class="n">outputFlag</span> <span class="o">=</span> <span class="n">outputFlag</span><span class="p">,</span> 
            <span class="n">timeLimit</span> <span class="o">=</span> <span class="n">timeLimit</span><span class="p">,</span> 
            <span class="n">gapTolerance</span> <span class="o">=</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fml&#39;</span><span class="p">]</span>
        <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;Heuristic&#39;</span><span class="p">):</span>
        <span class="n">nodeObj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
            <span class="n">nodeObj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">RouteNode</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">locFieldName</span><span class="p">])</span>
        <span class="n">tsp</span> <span class="o">=</span> <span class="n">_heuTSP</span><span class="p">(</span>
            <span class="n">nodeObj</span> <span class="o">=</span> <span class="n">nodeObj</span><span class="p">,</span> 
            <span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span><span class="p">,</span> 
            <span class="n">depotID</span> <span class="o">=</span> <span class="n">depotID</span><span class="p">,</span> 
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">,</span> 
            <span class="n">asymFlag</span> <span class="o">=</span> <span class="n">asymFlag</span><span class="p">,</span> 
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: Select &#39;algo&#39; from [&#39;IP&#39;, &#39;Heuristic&#39;].&quot;</span><span class="p">)</span>

    <span class="c1"># Fix the sequence to make it start from the depot ========================</span>
    <span class="n">startIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;seq&#39;</span><span class="p">]]</span>
    <span class="n">nodeSeq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">depotID</span><span class="p">):</span>
            <span class="n">startIndex</span> <span class="o">=</span> <span class="n">k</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">startIndex</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">nodeSeq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">startIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">):</span>
            <span class="n">nodeSeq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">nodeSeq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depotID</span><span class="p">)</span>
    <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;seq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodeSeq</span>

    <span class="c1"># Add service time if provided ============================================</span>
    <span class="n">hasServiceTimeInfoFlag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sumServiceTime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceTime&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]):</span>
            <span class="n">sumServiceTime</span> <span class="o">+=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;serviceTime&#39;</span><span class="p">]</span>
            <span class="n">hasServiceTimeInfoFlag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hasServiceTimeInfoFlag</span><span class="p">):</span>
        <span class="n">ofv</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;ofv&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">serviceTime</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ofv</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;ofv&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sumServiceTime</span>

    <span class="c1"># Post optimization (for detail information) ==============================</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">detailsFlag</span><span class="p">):</span>
        <span class="c1"># 返回一个数组，表示路径中的每个点的位置，不包括时间信息</span>
        <span class="n">shapepoints</span> <span class="o">=</span> <span class="p">[]</span>        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeSeq</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">shapepoints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">shapepoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># 返回一个数组，其中每个元素为二元数组，表示位置+时刻</span>
        <span class="n">curTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">curLoc</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">depotID</span><span class="p">][</span><span class="n">locFieldName</span><span class="p">]</span>
        <span class="n">timedSeq</span> <span class="o">=</span> <span class="p">[(</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">)]</span>
        <span class="c1"># 对每个leg检索path中的shapepoints，涉及到serviceTime，先不看最后一段leg</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeSeq</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># 对于Euclidean型的，没有中间节点</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">edges</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;LatLon&#39;</span><span class="p">]):</span>
                <span class="n">curTime</span> <span class="o">+=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">/</span> <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>
                <span class="n">curLoc</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">locFieldName</span><span class="p">]</span>
                <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shapepointsInBtw</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapepointsInBtw</span><span class="p">)):</span>
                    <span class="n">curTime</span> <span class="o">+=</span> <span class="n">distEuclideanXY</span><span class="p">(</span><span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>
                    <span class="n">curLoc</span> <span class="o">=</span> <span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>
            <span class="c1"># 如果有service time，则加上一段在原处等待的时间</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceTime&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">]]):</span>
                <span class="n">curTime</span> <span class="o">+=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;serviceTime&#39;</span><span class="p">]</span>
                <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">serviceTime</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">serviceTime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">curTime</span> <span class="o">+=</span> <span class="n">serviceTime</span>
                <span class="c1"># curLoc = curLoc</span>
                <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>
        <span class="c1"># 现在补上最后一段leg</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">edges</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;LatLon&#39;</span><span class="p">]):</span>
            <span class="n">curTime</span> <span class="o">+=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">/</span> <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>
            <span class="n">curLoc</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">locFieldName</span><span class="p">]</span>
            <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shapepointsInBtw</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">nodeSeq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapepointsInBtw</span><span class="p">)):</span>
                <span class="n">curTime</span> <span class="o">+=</span> <span class="n">distEuclideanXY</span><span class="p">(</span><span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>
                <span class="n">curLoc</span> <span class="o">=</span> <span class="n">shapepointsInBtw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">timedSeq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curLoc</span><span class="p">,</span> <span class="n">curTime</span><span class="p">))</span>

        <span class="c1"># Add detail information to `vehicles`</span>
        <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;shapepoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapepoints</span>
        <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicleID</span><span class="p">][</span><span class="s1">&#39;timedSeq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timedSeq</span>

    <span class="c1"># Add service time info ===================================================</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">nodeSeq</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;IP&#39;</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;gap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;gap&#39;</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;solType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;solType&#39;</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;lowerBound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;lowerBound&#39;</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;upperBound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;upperBound&#39;</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsp</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">]</span>    
    <span class="k">if</span> <span class="p">(</span><span class="n">metaFlag</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;algo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algo</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;serviceTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serviceTime</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">detailsFlag</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;vehicles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vehicles</span>

    <span class="k">return</span> <span class="n">res</span></div>


<span class="k">def</span> <span class="nf">_ipTSP</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">fml</span><span class="p">,</span> <span class="n">predefinedArcs</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span>
    <span class="n">tsp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;Gurobi&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;DFJ_Lazy&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiLazyCuts</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">predefinedArcs</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;DFJ_Plainloop&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiPlainLoop</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;MTZ&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiMTZ</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;ShortestPath&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiShortestPath</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;MultiCommodityFlow&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiMultiCommodityFlow</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;QAP&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPGurobiQAP</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;COPT&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fml</span> <span class="o">==</span> <span class="s1">&#39;DFJ_Lazy&#39;</span><span class="p">):</span>
            <span class="n">tsp</span> <span class="o">=</span> <span class="n">_ipTSPCOPTLazyCuts</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tsp</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UnsupportedInputError</span><span class="p">(</span><span class="s2">&quot;ERROR: Incorrect or not available TSP formulation option!&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">tsp</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiLazyCuts</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">predefinedArcs</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                
    <span class="c1"># TSP objective function ==================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">modelSense</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">Params</span><span class="o">.</span><span class="n">lazyConstraints</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Degree constraints ======================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;leave_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;enter_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># Predefined arcs =========================================================</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">predefinedArcs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">predefinedArcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arcs</span> <span class="ow">in</span> <span class="n">predefinedArcs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">arcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UnsupportedInputError</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find arc[</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] and/or arc[</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">arcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Sub-tour elimination ====================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="nf">subtourelim</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">where</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Callback</span><span class="o">.</span><span class="n">MIPSOL</span><span class="p">):</span>
            <span class="n">x_sol</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cbGetSolution</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x_sol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">):</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">cbLazy</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">component</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">component</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># TSP with callback =======================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">subtourelim</span><span class="p">)</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">currentNode</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentNode</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentNode</span><span class="p">)</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiPlainLoop</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                
    <span class="c1"># TSP =====================================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">modelSense</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">Params</span><span class="o">.</span><span class="n">lazyConstraints</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Degree constraints ======================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;leave_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;enter_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># Resolve to optimality and try to find sub-tours =========================</span>
    <span class="n">noSubtourFlag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">accRuntime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">noSubtourFlag</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span> <span class="o">-</span> <span class="n">accRuntime</span><span class="p">)</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
            <span class="n">accRuntime</span> <span class="o">+=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">):</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">)]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">noSubtourFlag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                    <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
            <span class="n">accRuntime</span> <span class="o">+=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
            <span class="k">break</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">currentNode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">accRuntime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">accRuntime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiMTZ</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
            <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;u_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># TSP objective function ==================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">modelSense</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Degree constraints ======================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;leave_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;enter_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># Sequence constraints ====================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;seq_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># TSP =====================================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Params</span><span class="o">.</span><span class="n">MIPGapAbs</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">currentNode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>    
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiShortestPath</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                        <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span>

    <span class="c1"># Stage constraints =======================================================</span>
    <span class="c1"># Start from depot </span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># First stage</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># In between</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Last stage</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Return to depot</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Consequent</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># TSP =====================================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">currentNode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiMultiCommodityFlow</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">)</span>

    <span class="c1"># TSP objective function ==================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">modelSense</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Degree constraints ======================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;leave_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;enter_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># MCF ====================================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">k</span><span class="p">):</span>
                <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> 
                    <span class="o">-</span> <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># TSP =====================================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">currentNode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">currentNode</span><span class="p">])</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPGurobiQAP</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">grb</span>
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find Gurobi&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;TSP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gapTolerance</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">,</span> <span class="n">gapTolerance</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">vtype</span> <span class="o">=</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span><span class="p">)</span>

    <span class="c1"># TSP objective function ==================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span>
        <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
            <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                    <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">+</span> 
        <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
            <span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                <span class="n">tau</span><span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Assignment constraints ==================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">grb</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Linearized constraints ==================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Optimize ================================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">X</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">):</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">break</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">grb</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">MIPGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjBoundC</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">ObjVal</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">Runtime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_ipTSPCOPTLazyCuts</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">coptpy</span> <span class="k">as</span> <span class="nn">cp</span>            
    <span class="k">except</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot find COPT&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">env</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Envr</span><span class="p">(</span><span class="n">envconfig</span><span class="p">)</span>
    <span class="n">TSP</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">createModel</span><span class="p">(</span><span class="s2">&quot;TSP&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outputFlag</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">Logging</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">)</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">LogToConsole</span><span class="p">,</span> <span class="n">outputFlag</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">Param</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">,</span> <span class="n">timeLimit</span><span class="p">)</span>

    <span class="c1"># Decision variables ======================================================</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                    <span class="n">vtype</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> 
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> 
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                
    <span class="c1"># TSP objective function ==================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">ObjSense</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">MINIMIZE</span>

    <span class="c1"># Degree constraints ======================================================</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;leave_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">TSP</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodeIDs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;enter_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># Callback ================================================================</span>
    <span class="k">class</span> <span class="nc">CoptCallback</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">CallbackBase</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">()</span> <span class="o">==</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">CBCONTEXT_MIPSOL</span><span class="p">):</span>
                <span class="c1"># print(&quot;Called me!&quot;)</span>
                <span class="n">x_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSolution</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x_sol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">):</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">)]</span>
                <span class="c1"># print(components)</span>
                <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLazyConstr</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">component</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">component</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">CoptCallback</span><span class="p">()</span>

    <span class="c1"># TSP with callback =======================================================</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">CBCONTEXT_MIPSOL</span><span class="p">)</span>
    <span class="n">TSP</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

    <span class="c1"># Reconstruct solution ====================================================</span>
    <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">solType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_Optimal&#39;</span>
        <span class="n">ofv</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">getObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
                <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">currentNode</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentNode</span><span class="p">)</span>
        <span class="c1"># print(arcs)</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arcs</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentNode</span><span class="p">):</span>
                    <span class="n">currentNode</span> <span class="o">=</span> <span class="n">arcs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentNode</span><span class="p">)</span>
                    <span class="n">arcs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ofv</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">SolvingTime</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">TSP</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">cp</span><span class="o">.</span><span class="n">COPT</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">):</span>
        <span class="n">solType</span> <span class="o">=</span> <span class="s1">&#39;IP_TimeLimit&#39;</span>
        <span class="n">ofv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gap</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">BestGap</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">BestBnd</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">BestObj</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">TSP</span><span class="o">.</span><span class="n">SolvingTime</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span><span class="p">,</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span>
        <span class="s1">&#39;solType&#39;</span><span class="p">:</span> <span class="n">solType</span><span class="p">,</span>
        <span class="s1">&#39;lowerBound&#39;</span><span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
        <span class="s1">&#39;upperBound&#39;</span><span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
        <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="n">runtime</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_heuTSP</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Construction heuristics =================================================</span>
    <span class="c1"># NOTE: Output of this phase should be a Route() object</span>
    <span class="n">seqObj</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">)</span>
    <span class="c1"># An initial solution is given</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;cons&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Initial&#39;</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;initSeq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingParameterError</span><span class="p">(</span><span class="s2">&quot;ERROR: Need &#39;initSeq&#39; for local improvement&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initSeq&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UnsupportedInputError</span><span class="p">(</span><span class="s2">&quot;ERROR: Length of &#39;initSeq&#39; is incorrect, check if the sequence starts and ends with `depotID`&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notInNodeIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initSeq&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notInNodeIDs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: The following nodes in &#39;initSeq&#39; is not in `nodeIDs`: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">list2String</span><span class="p">(</span><span class="n">notInNodeIDs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initSeq&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">seqObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Insertion heuristic</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Insertion&#39;</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RandomInsertion&#39;</span><span class="p">):</span>
        <span class="n">initSeq</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">randomInsertionFlag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RandomInsertion&#39;</span><span class="p">):</span>
            <span class="n">randomInsertionFlag</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;initSeq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>   
            <span class="n">farthestDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">farthestID</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">depotID</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">depotID</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">farthestDist</span><span class="p">):</span>
                        <span class="n">farthestID</span> <span class="o">=</span> <span class="n">n</span>
                        <span class="n">farthestDist</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">depotID</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">depotID</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">depotID</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">farthestDist</span><span class="p">):</span>
                        <span class="n">farthestID</span> <span class="o">=</span> <span class="n">n</span>
                        <span class="n">farthestDist</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">depotID</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
            <span class="n">initSeq</span> <span class="o">=</span> <span class="p">[</span><span class="n">depotID</span><span class="p">,</span> <span class="n">farthestID</span><span class="p">,</span> <span class="n">depotID</span><span class="p">]</span>
            <span class="n">seqObj</span> <span class="o">=</span> <span class="n">_consTSPInsertion</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">initSeq</span><span class="p">,</span> <span class="n">nodeObj</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">,</span> <span class="n">randomInsertionFlag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notInNodeIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initSeq&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notInNodeIDs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">OutOfRangeError</span><span class="p">(</span><span class="s2">&quot;ERROR: The following nodes in &#39;initSeq&#39; is not in `nodeIDs`: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">list2String</span><span class="p">(</span><span class="n">notInNodeIDs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seqObj</span> <span class="o">=</span> <span class="n">_consTSPInsertion</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initSeq&#39;</span><span class="p">],</span> <span class="n">tau</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">,</span> <span class="n">randomInsertionFlag</span><span class="p">)</span>
    
    <span class="c1"># Neighborhood based heuristic, including nearest neighborhood, k-nearest neighborhood, and furthest neighborhood</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NearestNeighbor&#39;</span><span class="p">):</span>
        <span class="n">nnSeq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">nnSeq</span> <span class="o">=</span> <span class="n">_consTSPkNearestNeighbor</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">nnSeq</span> <span class="o">=</span> <span class="n">_consTSPFarthestNeighbor</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">nnSeq</span> <span class="o">=</span> <span class="n">_consTSPkNearestNeighbor</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nnSeq</span><span class="p">:</span>
            <span class="n">seqObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Sweep heuristic</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Sweep&#39;</span><span class="p">):</span>
        <span class="n">sweepSeq</span> <span class="o">=</span> <span class="n">_consTSPSweep</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">locFieldName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sweepSeq</span><span class="p">:</span>
            <span class="n">seqObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">seqObj</span><span class="o">.</span><span class="n">rehead</span><span class="p">(</span><span class="n">depotID</span><span class="p">)</span>

    <span class="c1"># Christofides Algorithm, guaranteed &lt;= 1.5 * optimal</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Christofides&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">asymFlag</span><span class="p">):</span>
            <span class="n">cfSeq</span> <span class="o">=</span> <span class="n">_consTSPChristofides</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cfSeq</span><span class="p">:</span>
                <span class="n">seqObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnsupportedInputError</span><span class="p">(</span><span class="s2">&quot;ERROR: &#39;Christofides&#39; algorithm is not designed for Asymmetric TSP&quot;</span><span class="p">)</span>

    <span class="c1"># Cycle Cover Algorithm, specially designed for Asymmetric TSP</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CycleCover&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">VrpSolverNotAvailableError</span><span class="p">(</span><span class="s2">&quot;ERROR: &#39;CycleCover&#39; algorithm is not available yet, please stay tune&quot;</span><span class="p">)</span>
        <span class="n">seqObj</span> <span class="o">=</span> <span class="n">_consTSPCycleCover</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>

    <span class="c1"># Randomly create a sequence</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cons&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Random&#39;</span><span class="p">):</span>
        <span class="n">rndSeq</span> <span class="o">=</span> <span class="n">_consTSPRandom</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rndSeq</span><span class="p">:</span>
            <span class="n">seqObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">seqObj</span><span class="o">.</span><span class="n">rehead</span><span class="p">(</span><span class="n">depotID</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UnsupportedInputError</span><span class="p">(</span><span class="n">ERROR_MISSING_TSP_ALGO</span><span class="p">)</span>

    <span class="c1"># Cleaning seq before local improving =====================================</span>
    <span class="n">consOfv</span> <span class="o">=</span> <span class="n">seqObj</span><span class="o">.</span><span class="n">dist</span>

    <span class="c1"># Local improvement phase =================================================</span>
    <span class="c1"># NOTE: Local improvement phase operates by class kwargss</span>
    <span class="c1"># NOTE: For the local improvement, try every local search operator provided in a greedy way</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;impv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;impv&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;impv&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]):</span>
        <span class="n">canImpvFlag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">canImpvFlag</span><span class="p">):</span>
            <span class="n">canImpvFlag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># 2Opt</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">canImpvFlag</span> <span class="ow">and</span> <span class="s1">&#39;2Opt&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;impv&#39;</span><span class="p">]):</span>
                <span class="n">canImpvFlag</span> <span class="o">=</span> <span class="n">seqObj</span><span class="o">.</span><span class="n">impv2Opt</span><span class="p">()</span>

    <span class="n">ofv</span> <span class="o">=</span> <span class="n">seqObj</span><span class="o">.</span><span class="n">dist</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">seqObj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">closeFlag</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ofv&#39;</span><span class="p">:</span> <span class="n">ofv</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="n">seq</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">_consTSPkNearestNeighbor</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Initialize ----------------------------------------------------------</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">depotID</span><span class="p">]</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">))</span> <span class="k">if</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">depotID</span><span class="p">]</span>
    <span class="c1"># Accumulate seq ------------------------------------------------------</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remain</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">currentNodeID</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Sort the distance from current node to the rest of nodes</span>
        <span class="n">sortedSeqHeap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">remain</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">currentNodeID</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">):</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">currentNodeID</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">sortedSeqHeap</span><span class="p">,</span> <span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="c1"># Get the kth of sorted node and append it to seq</span>
        <span class="n">nextNodeID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sortedSeqHeap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">nextNodeID</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">sortedSeqHeap</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nextNodeID</span><span class="p">)</span>

        <span class="c1"># Update remain</span>
        <span class="n">remain</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nextNodeID</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seq</span>

<span class="k">def</span> <span class="nf">_consTSPFarthestNeighbor</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
    <span class="c1"># Initialize ----------------------------------------------------------</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">depotID</span><span class="p">]</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">))</span> <span class="k">if</span> <span class="n">nodeIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">depotID</span><span class="p">]</span>
    <span class="c1"># Accumulate seq ------------------------------------------------------</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remain</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">nextLeng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">nextID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">remain</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nextLeng</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tau</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">nextLeng</span><span class="p">):</span>
                    <span class="n">nextID</span> <span class="o">=</span> <span class="n">n</span>
                    <span class="n">nextLeng</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="p">((</span><span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nextLeng</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tau</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nextLeng</span><span class="p">):</span>
                    <span class="n">nextID</span> <span class="o">=</span> <span class="n">n</span>
                    <span class="n">nextLeng</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">]</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nextID</span><span class="p">)</span>
        <span class="n">remain</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nextID</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seq</span>

<span class="k">def</span> <span class="nf">_consTSPSweep</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">,</span> <span class="n">locFieldName</span><span class="p">):</span>
    <span class="c1"># Sweep seq -----------------------------------------------------------</span>
    <span class="n">sweep</span> <span class="o">=</span> <span class="n">nodeSeqBySweeping</span><span class="p">(</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">,</span> 
        <span class="n">nodeIDs</span> <span class="o">=</span> <span class="n">nodeIDs</span><span class="p">,</span>
        <span class="n">refLoc</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">depotID</span><span class="p">][</span><span class="n">locFieldName</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sweep</span>

<span class="k">def</span> <span class="nf">_consTSPRandom</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">nodeIDs</span><span class="p">):</span>
    <span class="c1"># Get random seq ------------------------------------------------------</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span><span class="p">]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seq</span>

<span class="k">def</span> <span class="nf">_consTSPInsertion</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">,</span> <span class="n">initSeq</span><span class="p">,</span> <span class="n">nodeObj</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">,</span> <span class="n">randomInsertionFlag</span><span class="p">):</span>
    <span class="c1"># Initialize ----------------------------------------------------------</span>
    <span class="n">route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">asymFlag</span><span class="p">)</span>

    <span class="c1"># NOTE: initSeq should starts and ends with depotID</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">initSeq</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">route</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="n">unInserted</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodeIDs</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">initSeq</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">randomInsertionFlag</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">unInserted</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">unInserted</span><span class="p">:</span>
        <span class="n">route</span><span class="o">.</span><span class="n">cheapestInsert</span><span class="p">(</span><span class="n">nodeObj</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">route</span>
    
<span class="k">def</span> <span class="nf">_consTSPChristofides</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">subG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span><span class="p">:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">mst</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">minimum_spanning_tree</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="n">degreeOfEachNodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">degreeOfEachNodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">mst</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">degreeOfEachNodes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">degreeOfEachNodes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">subG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="n">matchG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">oddDegrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">degreeOfEachNodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">degreeOfEachNodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">oddDegrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oddDegrees</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">oddDegrees</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tau</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subG</span><span class="o">.</span><span class="n">edges</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subG</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
                <span class="n">matchG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    
    <span class="n">mwm</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">min_weight_matching</span><span class="p">(</span><span class="n">matchG</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">mwm</span><span class="p">:</span>
        <span class="n">subG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">eulerian_circuit</span><span class="p">(</span><span class="n">subG</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">depotID</span><span class="p">)</span>

    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">):</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">):</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">seq</span>

<span class="k">def</span> <span class="nf">_consTSPCycleCover</span><span class="p">(</span><span class="n">depotID</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">VrpSolverNotAvailableError</span><span class="p">(</span><span class="s2">&quot;ERROR: vrpSolver has not implement this kwargs yet&quot;</span><span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">vrpSolver 0.0.56 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">vrpSolver.tsp</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Lan Peng.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>